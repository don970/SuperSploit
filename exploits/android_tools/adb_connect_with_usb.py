import subprocess as sub
import time

from ppadb.client import Client as AdbClient


# Default is "127.0.0.1" and 5037
client = AdbClient(host="127.0.0.1", port=5037)
devices = client.devices()


# Get device ip address by running ifconfig wlan0 via a adb test
def ip():
    ipp = []
    for device in devices:
        devicesInfo = str(device.shell('ifconfig wlan0')).split('\n')
        ipp.append(str(devicesInfo[1].split(' ')[11]).split(':')[1])
    return ipp


# Connect to discovered device
def adb_connect():
    ipp = ip()
    if len(ipp) < 1:
        print("no connected devices")
        return
    sub.run(['adb', 'disconnect'])
    for x in ipp:
        print(f"{ipp.index(x)}: {x}")
    inn = input(f"please pick a device: ")
    sub.run(['adb', 'tcpip', '5555'])
    time.sleep(2)
    sub.run(["clear"])
    sub.run([f'adb', 'connect', f'{ipp[int(inn)]}:5555'])


adb_connect()
